 <!DOCTYPE html>
<html>
<body>
 <script>

  
  /**
 * encode via diacritics
 */
function encode() {
 string=document.getElementById("basetext").value
 hiddenstring=document.getElementById("hiddentext").value
 
 //Convert hidden text to array of bytes
 
  const codeUnits = new Uint16Array(hiddenstring.length);
  for (let i = 0; i < codeUnits.length; i++) {
    codeUnits[i] = hiddenstring.charCodeAt(i);
  }
  const charCodes = new Uint8Array(codeUnits.buffer);

 
  // Use the Unicode block for combining diacritics.
  // https://en.wikipedia.org/wiki/Combining_Diacritical_Marks
  const blockRangeMin = 0x0300

  // Build up a list of letters.
  let result = "";
  var chararray = [];
  for (let i = 0; i < charCodes.byteLength; i++) {
     chararray[i]=charCodes[i];
     const quotient = Math.floor(charCodes[i]/112);
     const remainder = charCodes[i] % 112;
     console.log(quotient);
     console.log(remainder);
     const codePoint1 = blockRangeMin+quotient;
     const codePoint2 = blockRangeMin+remainder;
     if (i < string.length){
       result +=string.charAt(i);
     }else{
       result+='a';
     }
     result += String.fromCodePoint(codePoint1);
     result+='a';
     result += String.fromCodePoint(codePoint2);
 }
   console.log(chararray);
   console.log(result.normalize("NFD"));
 document.getElementById("combinedtext").value = result;
}

function decode(){
  const encodedtext=document.getElementById("combinedtext").value
  const normalized=encodedtext.normalize("NFD")
  console.log(normalized);
  let hiddentext=''
  let basetext=''
  //const codeUnits = new Uint16Array(normalized.length);
  //  console.log(normalized.length)
  var chararray = [];
  let k=0;
  for (let i = 0; i < normalized.length; i++) {
    charcode = normalized.charCodeAt(i);
    console.log(charcode);
    if ( charcode <= 0x036F && charcode >= 0x0300){
      //console.log(charcode);
      chararray[k]=charcode-0x0300;
      k+=1;
      //hiddentext+='a'
    }else{
      basetext+=normalized.charAt(i);
    }
  }
  console.log(chararray);
  let truhiddentext=''
  const bytes = new Uint8Array(chararray.length/2);
  for (let i=0; i<chararray.length/2;i++){
    charcode1 = chararray[i];
    charcode2 = chararray[i+1];
    bytes[i]=charcode1*112+charcode2;
  }
  const charCodes = new Uint16Array(bytes.buffer);
  for (let i = 0; i < charCodes.length; i++) {
    truhiddentext += String.fromCharCode(charCodes[i]);
  }
  document.getElementById("basetext").value=basetext
  document.getElementById("hiddentext").value=truhiddentext
}
  
</script>
 
<h1>StegaMark</h1>
<p>text that will be the base to add hidden text</p>
 <textarea id="basetext" name="basetext" rows="4" cols="50" onkeyup="encode(); return false;"></textarea>
  <br><br>
<p>text that will be the hidden within base text</p>
 <textarea id="hiddentext" name="hiddentext" rows="4" cols="50" onkeyup="encode(); return false;"></textarea>
  <br><br>
<p>combined text</p>
 <textarea id="combinedtext" name="combinedtext" rows="4" cols="50" onkeyup="decode(); return false;"></textarea>
  <br><br>

</body>
</html> 
